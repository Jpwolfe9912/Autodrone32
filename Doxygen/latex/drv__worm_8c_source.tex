\hypertarget{drv__worm_8c_source}{}\doxysection{drv\+\_\+worm.\+c}
\label{drv__worm_8c_source}\index{/Users/jeremywolfe/Documents/STM32CubeIDE/Autodrone32/Src/drv/drv\_worm.c@{/Users/jeremywolfe/Documents/STM32CubeIDE/Autodrone32/Src/drv/drv\_worm.c}}
\mbox{\hyperlink{drv__worm_8c}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{drv__worm_8c_source_l00001}00001 }
\DoxyCodeLine{\Hypertarget{drv__worm_8c_source_l00009}00009 \textcolor{comment}{/* Includes */}}
\DoxyCodeLine{\Hypertarget{drv__worm_8c_source_l00010}00010 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{board_8h}{board.h}}"{}}}
\DoxyCodeLine{\Hypertarget{drv__worm_8c_source_l00011}00011 }
\DoxyCodeLine{\Hypertarget{drv__worm_8c_source_l00016}00016 \textcolor{keywordtype}{void}}
\DoxyCodeLine{\Hypertarget{drv__worm_8c_source_l00017}\mbox{\hyperlink{drv__worm_8c_a52927cc2126ccc2c38edb697a9cc420f}{00017}} \mbox{\hyperlink{drv__worm_8c_a52927cc2126ccc2c38edb697a9cc420f}{wormInit}}(\textcolor{keywordtype}{void})}
\DoxyCodeLine{\Hypertarget{drv__worm_8c_source_l00018}00018 \{}
\DoxyCodeLine{\Hypertarget{drv__worm_8c_source_l00019}00019     RCC-\/>AHB1ENR    |= RCC\_AHB1ENR\_GPIOAEN;}
\DoxyCodeLine{\Hypertarget{drv__worm_8c_source_l00020}00020     RCC-\/>AHB1ENR    |= RCC\_AHB1ENR\_GPIOCEN;}
\DoxyCodeLine{\Hypertarget{drv__worm_8c_source_l00021}00021     RCC-\/>APB2ENR    |= RCC\_APB2ENR\_SYSCFGEN;}
\DoxyCodeLine{\Hypertarget{drv__worm_8c_source_l00022}00022     RCC-\/>APB2ENR    |= RCC\_APB2ENR\_TIM1EN;}
\DoxyCodeLine{\Hypertarget{drv__worm_8c_source_l00023}00023 }
\DoxyCodeLine{\Hypertarget{drv__worm_8c_source_l00024}00024     \textcolor{comment}{/* GPIOA Initialization */}}
\DoxyCodeLine{\Hypertarget{drv__worm_8c_source_l00025}00025     \textcolor{comment}{// PA8 as TIM1 CH1}}
\DoxyCodeLine{\Hypertarget{drv__worm_8c_source_l00026}00026     GPIOA-\/>MODER    \&= \string~GPIO\_MODER\_MODER8;}
\DoxyCodeLine{\Hypertarget{drv__worm_8c_source_l00027}00027     GPIOA-\/>MODER    |= GPIO\_MODER\_MODER8\_1;}
\DoxyCodeLine{\Hypertarget{drv__worm_8c_source_l00028}00028     GPIOA-\/>OSPEEDR  |= GPIO\_OSPEEDR\_OSPEEDR8;}
\DoxyCodeLine{\Hypertarget{drv__worm_8c_source_l00029}00029     GPIOA-\/>OTYPER   \&= \string~GPIO\_OTYPER\_OT8;}
\DoxyCodeLine{\Hypertarget{drv__worm_8c_source_l00030}00030     GPIOA-\/>AFR[1]   \&= \string~GPIO\_AFRH\_AFRH0;}
\DoxyCodeLine{\Hypertarget{drv__worm_8c_source_l00031}00031     GPIOA-\/>AFR[1]   |= (0x1 << 0U);}
\DoxyCodeLine{\Hypertarget{drv__worm_8c_source_l00032}00032     \textcolor{comment}{// PA9 as TIM1 CH2}}
\DoxyCodeLine{\Hypertarget{drv__worm_8c_source_l00033}00033     GPIOA-\/>MODER    \&= \string~GPIO\_MODER\_MODER9;}
\DoxyCodeLine{\Hypertarget{drv__worm_8c_source_l00034}00034     GPIOA-\/>MODER    |= GPIO\_MODER\_MODER9\_1;}
\DoxyCodeLine{\Hypertarget{drv__worm_8c_source_l00035}00035     GPIOA-\/>OSPEEDR  |= GPIO\_OSPEEDR\_OSPEEDR9;}
\DoxyCodeLine{\Hypertarget{drv__worm_8c_source_l00036}00036     GPIOA-\/>OTYPER   \&= \string~GPIO\_OTYPER\_OT9;}
\DoxyCodeLine{\Hypertarget{drv__worm_8c_source_l00037}00037     GPIOA-\/>AFR[1]   \&= \string~GPIO\_AFRH\_AFRH1;}
\DoxyCodeLine{\Hypertarget{drv__worm_8c_source_l00038}00038     GPIOA-\/>AFR[1]   |= (0x1 << 4U);}
\DoxyCodeLine{\Hypertarget{drv__worm_8c_source_l00039}00039     \textcolor{comment}{// PC8 as output}}
\DoxyCodeLine{\Hypertarget{drv__worm_8c_source_l00040}00040     GPIOC-\/>MODER    \&= \string~GPIO\_MODER\_MODER8;}
\DoxyCodeLine{\Hypertarget{drv__worm_8c_source_l00041}00041     GPIOC-\/>PUPDR    |= GPIO\_PUPDR\_PUPDR8\_1;}
\DoxyCodeLine{\Hypertarget{drv__worm_8c_source_l00042}00042     \textcolor{comment}{// PC9 as output}}
\DoxyCodeLine{\Hypertarget{drv__worm_8c_source_l00043}00043     GPIOC-\/>MODER    \&= \string~GPIO\_MODER\_MODER9;}
\DoxyCodeLine{\Hypertarget{drv__worm_8c_source_l00044}00044     GPIOC-\/>PUPDR    |= GPIO\_PUPDR\_PUPDR9\_1;}
\DoxyCodeLine{\Hypertarget{drv__worm_8c_source_l00045}00045 }
\DoxyCodeLine{\Hypertarget{drv__worm_8c_source_l00046}00046     \textcolor{comment}{/* TIM1 Initialization */}}
\DoxyCodeLine{\Hypertarget{drv__worm_8c_source_l00047}00047     TIM1-\/>CCMR1     \&= \string~TIM\_CCMR1\_OC1M;}
\DoxyCodeLine{\Hypertarget{drv__worm_8c_source_l00048}00048     TIM1-\/>CCMR1     |= TIM\_CCMR1\_OC1M\_1 | TIM\_CCMR1\_OC1M\_2;     \textcolor{comment}{// enable CH1 as PWM mode on CCMR1}}
\DoxyCodeLine{\Hypertarget{drv__worm_8c_source_l00049}00049     TIM1-\/>BDTR      |= TIM\_BDTR\_MOE;}
\DoxyCodeLine{\Hypertarget{drv__worm_8c_source_l00050}00050     TIM1-\/>CCER      |= TIM\_CCER\_CC1E;                           \textcolor{comment}{// enables channel 1 as output}}
\DoxyCodeLine{\Hypertarget{drv__worm_8c_source_l00051}00051 }
\DoxyCodeLine{\Hypertarget{drv__worm_8c_source_l00052}00052     TIM1-\/>CCMR1     \&= \string~TIM\_CCMR1\_OC2M;}
\DoxyCodeLine{\Hypertarget{drv__worm_8c_source_l00053}00053     TIM1-\/>CCMR1     |= TIM\_CCMR1\_OC2M\_1 | TIM\_CCMR1\_OC2M\_2;     \textcolor{comment}{// enable CH1 as PWM mode on CCMR1}}
\DoxyCodeLine{\Hypertarget{drv__worm_8c_source_l00054}00054     TIM1-\/>CCER      |= TIM\_CCER\_CC2E;                           \textcolor{comment}{// enables channel 1 as output}}
\DoxyCodeLine{\Hypertarget{drv__worm_8c_source_l00055}00055 }
\DoxyCodeLine{\Hypertarget{drv__worm_8c_source_l00056}00056     TIM1-\/>PSC       = 0;}
\DoxyCodeLine{\Hypertarget{drv__worm_8c_source_l00057}00057     TIM1-\/>ARR       = 5082 -\/ 1;         \textcolor{comment}{// 42.5kHz}}
\DoxyCodeLine{\Hypertarget{drv__worm_8c_source_l00058}00058     TIM1-\/>BDTR      |= TIM\_BDTR\_MOE;}
\DoxyCodeLine{\Hypertarget{drv__worm_8c_source_l00059}00059     TIM1-\/>CNT       = 0;                \textcolor{comment}{// start the counter at 0}}
\DoxyCodeLine{\Hypertarget{drv__worm_8c_source_l00060}00060     TIM1-\/>CR1       |= TIM\_CR1\_CEN;}
\DoxyCodeLine{\Hypertarget{drv__worm_8c_source_l00061}00061 }
\DoxyCodeLine{\Hypertarget{drv__worm_8c_source_l00062}00062     \textcolor{comment}{/* GPIO IRQ Initialization */}}
\DoxyCodeLine{\Hypertarget{drv__worm_8c_source_l00063}00063     SYSCFG-\/>EXTICR[2]   |= SYSCFG\_EXTICR3\_EXTI8\_PC |}
\DoxyCodeLine{\Hypertarget{drv__worm_8c_source_l00064}00064                            SYSCFG\_EXTICR3\_EXTI9\_PC;}
\DoxyCodeLine{\Hypertarget{drv__worm_8c_source_l00065}00065     EXTI-\/>IMR           |= EXTI\_IMR\_IM8 |}
\DoxyCodeLine{\Hypertarget{drv__worm_8c_source_l00066}00066                            EXTI\_IMR\_IM9;}
\DoxyCodeLine{\Hypertarget{drv__worm_8c_source_l00067}00067     EXTI-\/>RTSR          |= EXTI\_RTSR\_TR8 |}
\DoxyCodeLine{\Hypertarget{drv__worm_8c_source_l00068}00068                            EXTI\_RTSR\_TR9;}
\DoxyCodeLine{\Hypertarget{drv__worm_8c_source_l00069}00069     NVIC\_SetPriority(EXTI9\_5\_IRQn, 0);}
\DoxyCodeLine{\Hypertarget{drv__worm_8c_source_l00070}00070     NVIC\_EnableIRQ(EXTI9\_5\_IRQn);}
\DoxyCodeLine{\Hypertarget{drv__worm_8c_source_l00071}00071 \}}
\DoxyCodeLine{\Hypertarget{drv__worm_8c_source_l00072}00072 }
\DoxyCodeLine{\Hypertarget{drv__worm_8c_source_l00073}00073 \textcolor{keywordtype}{void}}
\DoxyCodeLine{\Hypertarget{drv__worm_8c_source_l00074}\mbox{\hyperlink{drv__worm_8c_a78fe2b56d78800c139e0977b06b0a465}{00074}} \mbox{\hyperlink{drv__worm_8c_a78fe2b56d78800c139e0977b06b0a465}{wormDrive}}(\textcolor{keywordtype}{float} sp1, \textcolor{keywordtype}{float} sp2)}
\DoxyCodeLine{\Hypertarget{drv__worm_8c_source_l00075}00075 \{}
\DoxyCodeLine{\Hypertarget{drv__worm_8c_source_l00076}00076     TIM1-\/>CCR1 = (uint32\_t)(5082 * sp1) -\/ 1;}
\DoxyCodeLine{\Hypertarget{drv__worm_8c_source_l00077}00077     TIM1-\/>CCR2 = (uint32\_t)(5082 * sp2) -\/ 1;}
\DoxyCodeLine{\Hypertarget{drv__worm_8c_source_l00078}00078 \}}
\DoxyCodeLine{\Hypertarget{drv__worm_8c_source_l00079}00079 }
\DoxyCodeLine{\Hypertarget{drv__worm_8c_source_l00080}00080 \textcolor{keywordtype}{void}}
\DoxyCodeLine{\Hypertarget{drv__worm_8c_source_l00081}\mbox{\hyperlink{drv__worm_8c_a7b2096b8b2643286dc3a7e5110e5ae85}{00081}} \mbox{\hyperlink{drv__worm_8c_a7b2096b8b2643286dc3a7e5110e5ae85}{EXTI9\_5\_IRQHandler}}(\textcolor{keywordtype}{void})}
\DoxyCodeLine{\Hypertarget{drv__worm_8c_source_l00082}00082 \{}
\DoxyCodeLine{\Hypertarget{drv__worm_8c_source_l00083}00083     \textcolor{keywordflow}{if}(EXTI-\/>PR \& EXTI\_PR\_PR8)\{}
\DoxyCodeLine{\Hypertarget{drv__worm_8c_source_l00084}00084         EXTI-\/>PR |= EXTI\_PR\_PR8;}
\DoxyCodeLine{\Hypertarget{drv__worm_8c_source_l00085}00085         TIM1-\/>CCER \string^= TIM\_CCER\_CC1E;}
\DoxyCodeLine{\Hypertarget{drv__worm_8c_source_l00086}00086     \}}
\DoxyCodeLine{\Hypertarget{drv__worm_8c_source_l00087}00087     \textcolor{keywordflow}{if}(EXTI-\/>PR \& EXTI\_PR\_PR9)\{}
\DoxyCodeLine{\Hypertarget{drv__worm_8c_source_l00088}00088         EXTI-\/>PR |= EXTI\_PR\_PR9;}
\DoxyCodeLine{\Hypertarget{drv__worm_8c_source_l00089}00089         TIM1-\/>CCER \string^= TIM\_CCER\_CC2E;}
\DoxyCodeLine{\Hypertarget{drv__worm_8c_source_l00090}00090     \}}
\DoxyCodeLine{\Hypertarget{drv__worm_8c_source_l00091}00091 \}}

\end{DoxyCode}
